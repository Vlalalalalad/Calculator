<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Калькулятор прироста</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
  <div class="bg-gray-800 p-6 rounded-2xl shadow-lg w-full max-w-sm">
    <h1 class="text-xl font-bold mb-4 text-center">Калькулятор прироста (%)</h1>
    <label class="block mb-2">Старая цена:
      <input type="number" id="oldPrice" step="any" class="w-full p-2 rounded bg-gray-700 border border-gray-600 mt-1">
    </label>
    <button onclick="swapPrices()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded mb-2 transition">↔</button>
    <label class="block mb-2">Новая цена:
      <input type="number" id="newPrice" step="any" class="w-full p-2 rounded bg-gray-700 border border-gray-600 mt-1">
    </label>
    <label class="block mb-2">Сумма входа ($):
      <input type="number" id="entryAmount" step="any" class="w-full p-2 rounded bg-gray-700 border border-gray-600 mt-1">
    </label>
    <label class="block mb-4">Плечо: <span id="leverageValue" class="font-semibold">1</span>x
      <input type="range" id="leverage" min="1" max="400" step="1" value="1" class="w-full mt-1">
    </label>
    <button onclick="calculate()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded mb-4 transition">Посчитать</button>
    <p id="result" class="text-center text-lg font-semibold"></p>
  </div>
  <script>
    // Завантаження даних із localStorage при завантаженні сторінки
    window.onload = function() {
      const savedData = JSON.parse(localStorage.getItem('calcData')) || {};
      document.getElementById('oldPrice').value = savedData.oldPrice || '';
      document.getElementById('newPrice').value = savedData.newPrice || '';
      document.getElementById('entryAmount').value = savedData.entryAmount || '';
      document.getElementById('leverage').value = savedData.leverage || 1;
      document.getElementById('leverageValue').textContent = savedData.leverage || 1;
    };

    // Оновлення значення плеча з "магнітним" ефектом
    document.getElementById('leverage').addEventListener('input', function() {
      document.getElementById('leverageValue').textContent = this.value;
    });

    document.getElementById('leverage').addEventListener('change', function() {
      let value = parseInt(this.value);
      // Округлення до найближчого кратного 10
      value = Math.round(value / 10) * 10;
      // Обмеження до min=1 і max=400
      value = Math.max(1, Math.min(400, value));
      this.value = value;
      document.getElementById('leverageValue').textContent = value;
      saveFormData();
    });

    // Збереження даних форми
    function saveFormData() {
      const formData = {
        oldPrice: document.getElementById('oldPrice').value,
        newPrice: document.getElementById('newPrice').value,
        entryAmount: document.getElementById('entryAmount').value,
        leverage: document.getElementById('leverage').value
      };
      localStorage.setItem('calcData', JSON.stringify(formData));
    }

    // Обробка введення для збереження даних
    document.getElementById('oldPrice').addEventListener('input', saveFormData);
    document.getElementById('newPrice').addEventListener('input', saveFormData);
    document.getElementById('entryAmount').addEventListener('input', saveFormData);

    // Обмін значень oldPrice і newPrice
    function swapPrices() {
      const oldPrice = document.getElementById('oldPrice').value;
      const newPrice = document.getElementById('newPrice').value;
      document.getElementById('oldPrice').value = newPrice;
      document.getElementById('newPrice').value = oldPrice;
      saveFormData();
      calculate(); // Перерахунок після обміну
    }

    // Розрахунок
    function calculate() {
      const oldPrice = parseFloat(document.getElementById('oldPrice').value);
      const newPrice = parseFloat(document.getElementById('newPrice').value);
      const leverage = parseInt(document.getElementById('leverage').value);
      const entryAmount = parseFloat(document.getElementById('entryAmount').value);
      const result = document.getElementById('result');

      if (!oldPrice || !newPrice || !entryAmount) {
        result.textContent = "Введите все значения!";
        result.className = "text-center text-lg font-semibold text-red-400";
        return;
      }

      const percent = ((newPrice - oldPrice) / oldPrice) * 100;
      const leveragedPercent = percent * leverage;
      const profit = entryAmount * (leveragedPercent / 100);

      const profitColor = profit >= 0 ? 'text-green-400' : 'text-red-400';
      result.className = `text-center text-lg font-semibold ${profitColor}`;
      result.textContent = `Рост: ${percent.toFixed(2)}% | С плечом ${leverage}x: ${leveragedPercent.toFixed(2)}% | Прибыль: $${profit.toFixed(2)}`;
    }
  </script>
</body>
</html>
